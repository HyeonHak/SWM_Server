<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.1.min.js"></script>
</head>
<body>
<h3>회원 가입</h3>

    <table>
        <tr>
            <td>ID : </td>
            <td><input type="text" name="ID" id="ID"></td>
            <td><input type="button" value = "중복확인" id="check"> </td>
            <td><div id="TEXT" style="display : none">사용 가능</div></td>
        </tr>
        <tr>
           
            
            
        </tr>
        <tr>
            <td>비번 : </td>
            <td><input type="password" name="password" id="password"></td>
        </tr>
        <tr>
            <td><input type="submit" value="회원가입" id="OK"></td>
            <td><input type="button" onclick="location.href = '/' " value = "돌아가기"/></td>
        </tr>
    </table>
<script>
let CH = false;

function Showpass(status){
    document.getElementById('TEXT').style.display = status;
}

$("#OK").click(function(){
    if($("#password").val()== "") alert('비밀번호를 입력하세요.');
    else{
        if(CH){
        $.ajax({
            url: '/users/saved',
            async: true,
            type: 'POST',
            data:{
                id: $("#ID").val(),
                password : $("#password").val()
            },
            dataType: 'json',
            success : function(data){
                if(CH){
                    alert('회원가입 성공');
                    location.href='/';
                }
                else
                    alert('아이디 중복 확인 해주세요.');
            },
            error: function(err){
                alert('오류 발생'+JSON.stringify(err));
            }

        });
        }
        else{
            alert('아이디 중복 확인 해주세요');
        }
    }
});

$("#check").click(function(){
    
    if($("#ID").val()== "") alert('아이디를 입력하세요.');
    else{
        $.ajax({
            url: '/users/check',
            async: true,
            type: 'POST',
            data:{
                ID: $("#ID").val()
            },
            dataType: 'json',
            success : function(data){
                if(data.count == 1){                
                    alert('이미 사용중인 ID입니다.');
                    Showpass("None");
                }
                else {
                    CH = true;
                    Showpass("block");
                }
            },
            error: function(err){
                alert('오류 발생'+JSON.stringify(err));
            }

        });
    }
});

</script>
</body>
</html>